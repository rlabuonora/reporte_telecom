---
output:
  word_document:
    reference_docx: word_report.docx
graphics: yes
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE,
                      message = FALSE,
                      fig.width = 7, 
                      fig.height = 4.5)

options(scipen = 10000)




# Theme
source('../common.R')

radiobases <- import_radiobases()
FECHA_INFORME <- as.Date("2019-12-01")

month_label <- function(x) {
  y <- as_date(x)
  glue::glue("{month(x)}/{format(y, '%y')}")
}


```


# 4. Servicios de Telefonía móvil

## 70. Cantidad de radiobases
```{r}
serie_90 <- radiobases %>% 
  filter(year(fecha) == year(FECHA_INFORME)) %>% 
  filter(tipo == "Radiobases (total)") %>% 
  group_by(fecha) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

serie_90 %>% 
  ggplot(aes(factor(fecha), radiobases)) +
  geom_col(fill = pal[5], width = 0.5) + 
  geom_text(aes(label=number_format(big.mark=".", scale = 1)(radiobases)), 
            nudge_y = 5e2, size = 5) +
  scale_x_discrete(label = month_label,
                   expand = expand_scale(add = c(0.5, 0.5),
                                         mult = c(0, 0))) +
  scale_y_continuous(breaks = NULL) +
  geom_hline(yintercept = 0) +
  labs(x="", y="")
```




## 71. Cantidad de radiobases por departamento (diciembre 2019)
```{r}
tabla_91 <- radiobases %>% 
  filter(tipo == "Radiobases (total)") %>% 
  filter(fecha == FECHA_INFORME) %>% 
  group_by(depto) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

tabla_91 %>% 
  barras_horizontales(radiobases, depto, nudge_text = 1e2)
```

## 72. Cantidad de radiobases por operador (diciembre 2019)

```{r}
tabla_92 <-  radiobases %>% 
  filter(tipo == "Radiobases (total)") %>% 
  filter(fecha == FECHA_INFORME) %>% 
  group_by(empresa) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

g_92 <- tabla_92 %>% 
  pie_chart(radiobases, empresa) %>% 
  print
```







## 73. Cantidad de radiobases GSM

```{r}
serie_93 <- radiobases %>% 
  filter(year(fecha) == year(FECHA_INFORME)) %>% 
  filter(tipo == "Radiobases (GSM)") %>% 
  group_by(fecha) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

g_93 <- serie_93 %>% 
  ggplot(aes(factor(fecha), radiobases)) +
  geom_col(fill = pal[5], width = 0.5) + 
  geom_text(aes(label=number_format(big.mark=".", scale = 1)(radiobases)), 
            nudge_y = 100, size = 5) +
  scale_x_discrete(
    label=month_label,
    expand = expand_scale(add = c(0.5, 0.5),
                          mult = c(0, 0))) +
  scale_y_continuous(breaks = NULL) +
  geom_hline(yintercept = 0) +
  labs(x="", y="")
```

## 74. Cantidad de radiobases GSM por departamento (diciembre 2019)

```{r}
tabla_94 <- radiobases %>% 
  filter(fecha == FECHA_INFORME) %>% 
  filter(tipo == "Radiobases (GSM)") %>% 
  group_by(depto) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

tabla_94 %>% 
  barras_horizontales(radiobases, depto, nudge_text = 20)
```







## 75. Cantidad de radiobases GSM por operador (diciembre 2019)

```{r}
tabla_95 <- radiobases %>% 
  filter(fecha == FECHA_INFORME) %>% 
  filter(tipo == "Radiobases (GSM)") %>% 
  group_by(empresa) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

tabla_95 %>% 
  pie_chart(radiobases, empresa) %>% 
  print
```


## 76. Cantidad de radiobases 3G

```{r}
serie_96 <- radiobases %>% 
  filter(year(fecha) == year(FECHA_INFORME)) %>% 
  filter(tipo == "Radiobases (3G)") %>% 
  group_by(fecha) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

serie_96 %>% 
  ggplot(aes(factor(fecha), radiobases)) +
  geom_col(fill = pal[5], width = 0.5) + 
  geom_text(aes(label=number_format(big.mark=".", scale = 1)(radiobases)), 
            nudge_y = 100, size = 5) +
  scale_x_discrete(label = month_label, 
                   expand = expand_scale(add = c(0.5, 0.5),
                                         mult = c(0, 0))) +
  scale_y_continuous(breaks = NULL) +
  geom_hline(yintercept = 0) +
  labs(x="", y="")
```







## 77. Cantidad de radiobases 3G por departamento (diciembre 2019)

```{r}
tabla_97 <- radiobases %>% 
  filter(fecha == FECHA_INFORME) %>% 
  filter(tipo == "Radiobases (3G)") %>% 
  group_by(depto) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

tabla_97 %>% 
  barras_horizontales(radiobases, depto, nudge_text = 30)
```

## 78. Cantidad de radiobases 3G por operador (diciembre 2019)

```{r}
tabla_98 <-  radiobases %>% 
  filter(fecha == FECHA_INFORME) %>% 
  filter(tipo == "Radiobases (3G)") %>% 
  group_by(empresa) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE)) 

 tabla_98 %>% 
  pie_chart(radiobases, empresa) %>% 
   print
```







## 79. Cantidad de radiobases LTE

```{r}
serie_99 <- radiobases %>% 
  filter(year(fecha) == year(FECHA_INFORME)) %>% 
  filter(tipo == "Radiobases (LTE)") %>% 
  group_by(fecha) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

serie_99 %>% 
  mutate(year=year(fecha), month=month(fecha)) %>% 
  serie_historica_mensual(radiobases, nudge_text = 100)
```

## 80. Cantidad de radiobases LTE por departamento (diciembre 2019)
```{r}
tabla_100 <- radiobases %>% 
  filter(fecha == FECHA_INFORME) %>% 
  filter(tipo == "Radiobases (LTE)") %>% 
  group_by(depto) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

 tabla_100 %>% 
  barras_horizontales(radiobases, depto, nudge_text = 60)
```








## 81. Cantidad de radiobases LTE por operador (diciembre 2019)

```{r}
tabla_101 <- radiobases %>% 
  filter(fecha == FECHA_INFORME) %>% 
  filter(tipo == "Radiobases (LTE)") %>% 
  group_by(empresa) %>% 
  summarize(radiobases = sum(val, na.rm = TRUE))

tabla_101 %>% 
  pie_chart(radiobases, empresa) %>% 
  print
```

